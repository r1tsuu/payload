{"version":3,"sources":["../../src/bin/index.ts"],"sourcesContent":["/* eslint-disable no-console */\nimport minimist from 'minimist'\n\nimport type { BinScript } from '../config/types.js'\n\nimport { findConfig } from '../config/find.js'\nimport { generateTypes } from './generateTypes.js'\nimport { loadEnv } from './loadEnv.js'\nimport { migrate } from './migrate.js'\n\nexport const bin = async () => {\n  loadEnv()\n  const configPath = findConfig()\n  const configPromise = await import(configPath)\n  let config = await configPromise\n  if (config.default) config = await config.default\n\n  const args = minimist(process.argv.slice(2))\n  const script = (typeof args._[0] === 'string' ? args._[0] : '').toLowerCase()\n\n  const userBinScript = Array.isArray(config.bin)\n    ? config.bin.find(({ key }) => key === script)\n    : false\n\n  if (userBinScript) {\n    try {\n      const script: BinScript = await import(userBinScript.scriptPath)\n      await script(config)\n    } catch (err) {\n      console.log(`Could not find associated bin script for the ${userBinScript.key} command`)\n      console.error(err)\n    }\n\n    return\n  }\n\n  if (script.startsWith('migrate')) {\n    return migrate({ config, parsedArgs: args }).then(() => process.exit(0))\n  }\n\n  if (script === 'generate:types') {\n    return generateTypes(config)\n  }\n\n  console.log(`Unknown script: \"${script}\".`)\n  process.exit(1)\n}\n"],"names":["minimist","findConfig","generateTypes","loadEnv","migrate","bin","configPath","configPromise","config","default","args","process","argv","slice","script","_","toLowerCase","userBinScript","Array","isArray","find","key","scriptPath","err","console","log","error","startsWith","parsedArgs","then","exit"],"mappings":"AAAA,6BAA6B,GAC7B,OAAOA,cAAc,WAAU;AAI/B,SAASC,UAAU,QAAQ,oBAAmB;AAC9C,SAASC,aAAa,QAAQ,qBAAoB;AAClD,SAASC,OAAO,QAAQ,eAAc;AACtC,SAASC,OAAO,QAAQ,eAAc;AAEtC,OAAO,MAAMC,MAAM;IACjBF;IACA,MAAMG,aAAaL;IACnB,MAAMM,gBAAgB,MAAM,MAAM,CAACD;IACnC,IAAIE,SAAS,MAAMD;IACnB,IAAIC,OAAOC,OAAO,EAAED,SAAS,MAAMA,OAAOC,OAAO;IAEjD,MAAMC,OAAOV,SAASW,QAAQC,IAAI,CAACC,KAAK,CAAC;IACzC,MAAMC,SAAS,AAAC,CAAA,OAAOJ,KAAKK,CAAC,CAAC,EAAE,KAAK,WAAWL,KAAKK,CAAC,CAAC,EAAE,GAAG,EAAC,EAAGC,WAAW;IAE3E,MAAMC,gBAAgBC,MAAMC,OAAO,CAACX,OAAOH,GAAG,IAC1CG,OAAOH,GAAG,CAACe,IAAI,CAAC,CAAC,EAAEC,GAAG,EAAE,GAAKA,QAAQP,UACrC;IAEJ,IAAIG,eAAe;QACjB,IAAI;YACF,MAAMH,SAAoB,MAAM,MAAM,CAACG,cAAcK,UAAU;YAC/D,MAAMR,OAAON;QACf,EAAE,OAAOe,KAAK;YACZC,QAAQC,GAAG,CAAC,CAAC,6CAA6C,EAAER,cAAcI,GAAG,CAAC,QAAQ,CAAC;YACvFG,QAAQE,KAAK,CAACH;QAChB;QAEA;IACF;IAEA,IAAIT,OAAOa,UAAU,CAAC,YAAY;QAChC,OAAOvB,QAAQ;YAAEI;YAAQoB,YAAYlB;QAAK,GAAGmB,IAAI,CAAC,IAAMlB,QAAQmB,IAAI,CAAC;IACvE;IAEA,IAAIhB,WAAW,kBAAkB;QAC/B,OAAOZ,cAAcM;IACvB;IAEAgB,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEX,OAAO,EAAE,CAAC;IAC1CH,QAAQmB,IAAI,CAAC;AACf,EAAC"}