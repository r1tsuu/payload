{"version":3,"sources":["../../../src/bin/loader/resolveOriginalPath.ts"],"sourcesContent":["import fs from 'fs/promises'\nimport path from 'path'\n\n/**\n * In case any directory in the path contains symlinks, this function attempts to detect that resolves the original path.\n *\n * Example Input: /Users/alessio/Documents/GitHub/payload-3.0-alpha-demo/node_modules/tailwindcss/resolveConfig.js\n * The \"tailwindcss\" in this example is a symlinked directory.\n *\n * Example Output: /Users/alessio/Documents/GitHub/payload-3.0-alpha-demo/node_modules/.pnpm/tailwindcss@3.4.3/node_modules/tailwindcss/resolveConfig.js\n */\nexport async function resolveOriginalPath(filePath: string) {\n  try {\n    // Normalize and split the path\n    const parts = path.resolve(filePath).split(path.sep)\n    let currentPath = parts[0] || '/'\n    // skip the first slash\n    for (const part of parts.slice(1)) {\n      currentPath = path.join(currentPath, part)\n      // Check if the current path component is a symlink\n      const stats = await fs.lstat(currentPath)\n      if (stats.isSymbolicLink()) {\n        // Resolve the symlink\n        const resolvedLink = await fs.readlink(currentPath)\n        if (!path.isAbsolute(resolvedLink)) {\n          currentPath = path.join(path.dirname(currentPath), resolvedLink)\n        } else {\n          currentPath = resolvedLink\n        }\n      }\n    }\n    return currentPath\n  } catch (error) {\n    console.error('Error resolving path:', error)\n  }\n}\n"],"names":["fs","path","resolveOriginalPath","filePath","parts","resolve","split","sep","currentPath","part","slice","join","stats","lstat","isSymbolicLink","resolvedLink","readlink","isAbsolute","dirname","error","console"],"mappings":"AAAA,OAAOA,QAAQ,cAAa;AAC5B,OAAOC,UAAU,OAAM;AAEvB;;;;;;;CAOC,GACD,OAAO,eAAeC,oBAAoBC,QAAgB;IACxD,IAAI;QACF,+BAA+B;QAC/B,MAAMC,QAAQH,KAAKI,OAAO,CAACF,UAAUG,KAAK,CAACL,KAAKM,GAAG;QACnD,IAAIC,cAAcJ,KAAK,CAAC,EAAE,IAAI;QAC9B,uBAAuB;QACvB,KAAK,MAAMK,QAAQL,MAAMM,KAAK,CAAC,GAAI;YACjCF,cAAcP,KAAKU,IAAI,CAACH,aAAaC;YACrC,mDAAmD;YACnD,MAAMG,QAAQ,MAAMZ,GAAGa,KAAK,CAACL;YAC7B,IAAII,MAAME,cAAc,IAAI;gBAC1B,sBAAsB;gBACtB,MAAMC,eAAe,MAAMf,GAAGgB,QAAQ,CAACR;gBACvC,IAAI,CAACP,KAAKgB,UAAU,CAACF,eAAe;oBAClCP,cAAcP,KAAKU,IAAI,CAACV,KAAKiB,OAAO,CAACV,cAAcO;gBACrD,OAAO;oBACLP,cAAcO;gBAChB;YACF;QACF;QACA,OAAOP;IACT,EAAE,OAAOW,OAAO;QACdC,QAAQD,KAAK,CAAC,yBAAyBA;IACzC;AACF"}