{"version":3,"sources":["../../../src/auth/operations/access.ts"],"sourcesContent":["import type { PayloadRequestWithData } from '../../types/index.js'\nimport type { Permissions } from '../types.js'\n\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { adminInit as adminInitTelemetry } from '../../utilities/telemetry/events/adminInit.js'\nimport { getAccessResults } from '../getAccessResults.js'\n\ntype Arguments = {\n  req: PayloadRequestWithData\n}\n\nexport const accessOperation = async (args: Arguments): Promise<Permissions> => {\n  const { req } = args\n\n  adminInitTelemetry(req)\n\n  try {\n    const shouldCommit = await initTransaction(req)\n    const results = getAccessResults({ req })\n    if (shouldCommit) await commitTransaction(req)\n    return results\n  } catch (e: unknown) {\n    await killTransaction(req)\n    throw e\n  }\n}\n"],"names":["commitTransaction","initTransaction","killTransaction","adminInit","adminInitTelemetry","getAccessResults","accessOperation","args","req","shouldCommit","results","e"],"mappings":"AAGA,SAASA,iBAAiB,QAAQ,uCAAsC;AACxE,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,aAAaC,kBAAkB,QAAQ,gDAA+C;AAC/F,SAASC,gBAAgB,QAAQ,yBAAwB;AAMzD,OAAO,MAAMC,kBAAkB,OAAOC;IACpC,MAAM,EAAEC,GAAG,EAAE,GAAGD;IAEhBH,mBAAmBI;IAEnB,IAAI;QACF,MAAMC,eAAe,MAAMR,gBAAgBO;QAC3C,MAAME,UAAUL,iBAAiB;YAAEG;QAAI;QACvC,IAAIC,cAAc,MAAMT,kBAAkBQ;QAC1C,OAAOE;IACT,EAAE,OAAOC,GAAY;QACnB,MAAMT,gBAAgBM;QACtB,MAAMG;IACR;AACF,EAAC"}