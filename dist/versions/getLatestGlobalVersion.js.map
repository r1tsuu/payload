{"version":3,"sources":["../../src/versions/getLatestGlobalVersion.ts"],"sourcesContent":["import type { SanitizedGlobalConfig } from '../globals/config/types.js'\nimport type { Document, Payload, PayloadRequestWithData, Where } from '../types/index.js'\n\nimport { docHasTimestamps } from '../types/index.js'\n\ntype Args = {\n  config: SanitizedGlobalConfig\n  locale?: string\n  payload: Payload\n  req?: PayloadRequestWithData\n  slug: string\n  where: Where\n}\n\nexport const getLatestGlobalVersion = async ({\n  slug,\n  config,\n  locale,\n  payload,\n  req,\n  where,\n}: Args): Promise<{ global: Document; globalExists: boolean }> => {\n  let latestVersion\n\n  if (config.versions?.drafts) {\n    // eslint-disable-next-line prefer-destructuring\n    latestVersion = (\n      await payload.db.findGlobalVersions({\n        global: slug,\n        limit: 1,\n        locale,\n        pagination: false,\n        req,\n        sort: '-updatedAt',\n      })\n    ).docs[0]\n  }\n\n  const global = await payload.db.findGlobal({\n    slug,\n    locale,\n    req,\n    where,\n  })\n  const globalExists = Boolean(global)\n\n  if (!latestVersion || (docHasTimestamps(global) && latestVersion.updatedAt < global.updatedAt)) {\n    return {\n      global,\n      globalExists,\n    }\n  }\n\n  return {\n    global: {\n      ...latestVersion.version,\n      createdAt: latestVersion.createdAt,\n      updatedAt: latestVersion.updatedAt,\n    },\n    globalExists,\n  }\n}\n"],"names":["docHasTimestamps","getLatestGlobalVersion","slug","config","locale","payload","req","where","latestVersion","versions","drafts","db","findGlobalVersions","global","limit","pagination","sort","docs","findGlobal","globalExists","Boolean","updatedAt","version","createdAt"],"mappings":"AAGA,SAASA,gBAAgB,QAAQ,oBAAmB;AAWpD,OAAO,MAAMC,yBAAyB,OAAO,EAC3CC,IAAI,EACJC,MAAM,EACNC,MAAM,EACNC,OAAO,EACPC,GAAG,EACHC,KAAK,EACA;IACL,IAAIC;IAEJ,IAAIL,OAAOM,QAAQ,EAAEC,QAAQ;QAC3B,gDAAgD;QAChDF,gBAAgB,AACd,CAAA,MAAMH,QAAQM,EAAE,CAACC,kBAAkB,CAAC;YAClCC,QAAQX;YACRY,OAAO;YACPV;YACAW,YAAY;YACZT;YACAU,MAAM;QACR,EAAC,EACDC,IAAI,CAAC,EAAE;IACX;IAEA,MAAMJ,SAAS,MAAMR,QAAQM,EAAE,CAACO,UAAU,CAAC;QACzChB;QACAE;QACAE;QACAC;IACF;IACA,MAAMY,eAAeC,QAAQP;IAE7B,IAAI,CAACL,iBAAkBR,iBAAiBa,WAAWL,cAAca,SAAS,GAAGR,OAAOQ,SAAS,EAAG;QAC9F,OAAO;YACLR;YACAM;QACF;IACF;IAEA,OAAO;QACLN,QAAQ;YACN,GAAGL,cAAcc,OAAO;YACxBC,WAAWf,cAAce,SAAS;YAClCF,WAAWb,cAAca,SAAS;QACpC;QACAF;IACF;AACF,EAAC"}