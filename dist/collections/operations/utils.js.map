{"version":3,"sources":["../../../src/collections/operations/utils.ts"],"sourcesContent":["import type { forgotPasswordOperation } from '../../auth/operations/forgotPassword.js'\nimport type { loginOperation } from '../../auth/operations/login.js'\nimport type { refreshOperation } from '../../auth/operations/refresh.js'\nimport type { CollectionSlug } from '../../index.js'\nimport type { PayloadRequestWithData } from '../../types/index.js'\nimport type { AfterOperationHook, SanitizedCollectionConfig } from '../config/types.js'\nimport type { countOperation } from './count.js'\nimport type { createOperation } from './create.js'\nimport type { deleteOperation } from './delete.js'\nimport type { deleteByIDOperation } from './deleteByID.js'\nimport type { findOperation } from './find.js'\nimport type { findByIDOperation } from './findByID.js'\nimport type { updateOperation } from './update.js'\nimport type { updateByIDOperation } from './updateByID.js'\n\nexport type AfterOperationMap<TOperationGeneric extends CollectionSlug> = {\n  count: typeof countOperation<TOperationGeneric>\n  create: typeof createOperation<TOperationGeneric>\n  delete: typeof deleteOperation<TOperationGeneric>\n  deleteByID: typeof deleteByIDOperation<TOperationGeneric>\n  find: typeof findOperation<TOperationGeneric>\n  findByID: typeof findByIDOperation<TOperationGeneric>\n  forgotPassword: typeof forgotPasswordOperation\n  login: typeof loginOperation<TOperationGeneric>\n  refresh: typeof refreshOperation\n  update: typeof updateOperation<TOperationGeneric>\n  updateByID: typeof updateByIDOperation<TOperationGeneric>\n}\n\nexport type AfterOperationArg<TOperationGeneric extends CollectionSlug> = {\n  /** The collection which this hook is being run on */\n  collection: SanitizedCollectionConfig\n  req: PayloadRequestWithData\n} & (\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['count']>[0]\n      operation: 'count'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['count']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['create']>[0]\n      operation: 'create'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['create']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['delete']>[0]\n      operation: 'delete'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['delete']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['deleteByID']>[0]\n      operation: 'deleteByID'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['deleteByID']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['find']>[0]\n      operation: 'find'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['find']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['findByID']>[0]\n      operation: 'findByID'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['findByID']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['forgotPassword']>[0]\n      operation: 'forgotPassword'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['forgotPassword']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['login']>[0]\n      operation: 'login'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['login']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['refresh']>[0]\n      operation: 'refresh'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['refresh']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['update']>[0]\n      operation: 'update'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['update']>>\n    }\n  | {\n      args: Parameters<AfterOperationMap<TOperationGeneric>['updateByID']>[0]\n      operation: 'updateByID'\n      result: Awaited<ReturnType<AfterOperationMap<TOperationGeneric>['updateByID']>>\n    }\n)\n\ntype OperationResult<\n  TOperationGeneric extends CollectionSlug,\n  O extends keyof AfterOperationMap<TOperationGeneric>,\n> = Awaited<ReturnType<AfterOperationMap<TOperationGeneric>[O]>>\n\nexport const buildAfterOperation = async <\n  TOperationGeneric extends CollectionSlug,\n  O extends keyof AfterOperationMap<TOperationGeneric> = keyof AfterOperationMap<TOperationGeneric>,\n>(\n  operationArgs: Omit<AfterOperationArg<TOperationGeneric>, 'req'> & { operation: O },\n): Promise<OperationResult<TOperationGeneric, O> | any> => {\n  const { args, collection, operation, result } = operationArgs\n\n  let newResult = result as OperationResult<TOperationGeneric, O>\n\n  await args.collection.config.hooks.afterOperation.reduce(\n    async (priorHook, hook: AfterOperationHook<TOperationGeneric>) => {\n      await priorHook\n\n      const hookResult = await hook({\n        args,\n        collection,\n        operation,\n        req: args.req,\n        result: newResult,\n      } as AfterOperationArg<TOperationGeneric>)\n\n      if (hookResult !== undefined) {\n        newResult = hookResult as OperationResult<TOperationGeneric, O>\n      }\n    },\n    Promise.resolve(),\n  )\n\n  return newResult\n}\n"],"names":["buildAfterOperation","operationArgs","args","collection","operation","result","newResult","config","hooks","afterOperation","reduce","priorHook","hook","hookResult","req","undefined","Promise","resolve"],"mappings":"AAgGA,OAAO,MAAMA,sBAAsB,OAIjCC;IAEA,MAAM,EAAEC,IAAI,EAAEC,UAAU,EAAEC,SAAS,EAAEC,MAAM,EAAE,GAAGJ;IAEhD,IAAIK,YAAYD;IAEhB,MAAMH,KAAKC,UAAU,CAACI,MAAM,CAACC,KAAK,CAACC,cAAc,CAACC,MAAM,CACtD,OAAOC,WAAWC;QAChB,MAAMD;QAEN,MAAME,aAAa,MAAMD,KAAK;YAC5BV;YACAC;YACAC;YACAU,KAAKZ,KAAKY,GAAG;YACbT,QAAQC;QACV;QAEA,IAAIO,eAAeE,WAAW;YAC5BT,YAAYO;QACd;IACF,GACAG,QAAQC,OAAO;IAGjB,OAAOX;AACT,EAAC"}